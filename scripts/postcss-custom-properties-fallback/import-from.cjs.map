{"version":3,"file":"import-from.js","sources":["../src/import-from.js"],"sourcesContent":["const fs = require('fs');\nconst path = require('path');\nconst postcss = require('postcss');\nconst { parse } = require('postcss-values-parser');\n\nasync function getCustomPropertiesFromCSSFile(from) {\n  const css = await readFile(from);\n  // eslint-disable-next-line no-unused-vars\n  const root = postcss.parse(css, { from });\n\n  throw new Error('Importing from CSS files not supported yet');\n  //return getCustomPropertiesFromRoot(root, { preserve: true });\n}\n\n/* Get Custom Properties from Object\n/* ========================================================================== */\n\nfunction getCustomPropertiesFromObject(object) {\n  const customProperties = Object.assign(\n    {},\n    Object(object).customProperties,\n    Object(object)['custom-properties']\n  );\n\n  for (const key in customProperties) {\n    customProperties[key] = parse(String(customProperties[key])).nodes;\n  }\n\n  return customProperties;\n}\n\n/* Get Custom Properties from JSON file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSONFile(from) {\n  const object = await readJSON(from);\n\n  return getCustomPropertiesFromObject(object);\n}\n\n/* Get Custom Properties from JS file\n/* ========================================================================== */\n\nasync function getCustomPropertiesFromJSFile(from) {\n  const object = require(from);\n\n  return getCustomPropertiesFromObject(object);\n}\n\nmodule.exports = function getCustomPropertiesFromImports(sources) {\n  return sources\n    .map((source) => {\n      if (source instanceof Promise) {\n        return source;\n      } else if (source instanceof Function) {\n        return source();\n      }\n\n      // read the source as an object\n      const opts =\n        source === Object(source) ? source : { from: String(source) };\n\n      // skip objects with Custom Properties\n      if (opts.customProperties || opts['custom-properties']) {\n        return opts;\n      }\n\n      // source pathname\n      const from = path.resolve(String(opts.from || ''));\n\n      // type of file being read from\n      const type = (opts.type || path.extname(from).slice(1)).toLowerCase();\n\n      return { type, from };\n    })\n    .reduce(async (customProperties, source) => {\n      const { type, from } = await source;\n\n      if (type === 'css') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromCSSFile(from)\n        );\n      }\n\n      if (type === 'js') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromJSFile(from)\n        );\n      }\n\n      if (type === 'json') {\n        return Object.assign(\n          await customProperties,\n          await getCustomPropertiesFromJSONFile(from)\n        );\n      }\n\n      return Object.assign(\n        await customProperties,\n        await getCustomPropertiesFromObject(await source)\n      );\n    }, {});\n};\n\nconst readFile = (from) =>\n  new Promise((resolve, reject) => {\n    fs.readFile(from, 'utf8', (error, result) => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(result);\n      }\n    });\n  });\n\nconst readJSON = async (from) => JSON.parse(await readFile(from));\n"],"names":["fs","require","path","postcss","parse","getCustomPropertiesFromCSSFile","from","css","readFile","Error","getCustomPropertiesFromObject","object","customProperties","Object","assign","key","String","nodes","getCustomPropertiesFromJSONFile","readJSON","getCustomPropertiesFromJSFile","module","exports","getCustomPropertiesFromImports","sources","map","source","Promise","Function","opts","resolve","type","extname","slice","toLowerCase","reduce","reject","error","result","JSON"],"mappings":"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"}